<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Chatroom</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<div id="login">
  <h2>Login to Chat</h2>
  <input id="nameInput" placeholder="Enter Name">
  <input id="idInput" placeholder="Enter User ID (optional)">
  <input id="passInput" type="password" placeholder="Enter Password (if required)">
  <button id="joinBtn">Join Chat</button>
</div>

<div id="chat" style="display:none;">
  <div id="messages"></div>
  <input id="messageInput" placeholder="Type message...">
  <input type="file" id="pfpInput">
  <button id="sendBtn">Send</button>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();
const loginDiv = document.getElementById('login');
const chatDiv = document.getElementById('chat');

document.getElementById("joinBtn").onclick = () => {
  const name = document.getElementById("nameInput").value;
  const userId = document.getElementById("idInput").value;
  const password = document.getElementById("passInput").value;
  socket.emit("set-name", { name, userId, password });
  loginDiv.style.display = "none";
  chatDiv.style.display = "block";
};

// Set profile picture
document.getElementById("pfpInput").onchange = e => {
  const file = e.target.files[0];
  const reader = new FileReader();
  reader.onload = () => socket.emit("set-pfp", reader.result);
  reader.readAsDataURL(file);
};

// Send message
document.getElementById("sendBtn").onclick = () => {
  const msg = document.getElementById("messageInput").value;
  socket.emit("chat-message", { text: msg });
  document.getElementById("messageInput").value = "";
};

// Display messages
const messages = document.getElementById("messages");
socket.on("chat-message", msg => {
  const div = document.createElement("div");
  const pfpImg = msg.pfp ? `<img src="${msg.pfp}" style="width:25px;height:25px;border-radius:50%;margin-right:5px;">` : "";
  div.innerHTML = `${pfpImg}[${msg.role}] <b>${msg.name}</b>: ${msg.text}`;
  messages.appendChild(div);
  messages.scrollTop = messages.scrollHeight;
});

socket.on("system", msg => {
  const div = document.createElement("div");
  div.className = "system";
  div.textContent = `[SYSTEM] ${msg.text}`;
  messages.appendChild(div);
  messages.scrollTop = messages.scrollHeight;
});
</script>
</body>
</html>
