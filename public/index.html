<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Chatroom</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div id="login">
    <h2>Login to Chat</h2>
    <input id="nameInput" placeholder="Enter Name">
    <input id="idInput" placeholder="Enter User ID (optional)">
    <input id="passInput" type="password" placeholder="Enter Password (if required)">
    <button id="joinBtn">Join Chat</button>
  </div>

  <div id="chat" style="display:none;">
    <div id="messages"></div>
    <input id="messageInput" placeholder="Type message...">
    <button id="sendBtn">Send</button>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    const loginDiv = document.getElementById('login');
    const chatDiv = document.getElementById('chat');

    document.getElementById("joinBtn").onclick = () => {
      const name = document.getElementById("nameInput").value;
      const userId = document.getElementById("idInput").value;
      const password = document.getElementById("passInput").value;

      socket.emit("set-name", { name, userId, password });

      loginDiv.style.display = "none";
      chatDiv.style.display = "block";
    };

    document.getElementById("sendBtn").onclick = () => {
      const msg = document.getElementById("messageInput").value;
      socket.emit("chat-message", { text: msg });
      document.getElementById("messageInput").value = "";
    };

    socket.on("chat-message", (msg) => {
      const div = document.createElement("div");
      div.textContent = `[${msg.role}] ${msg.name}: ${msg.text}`;
      document.getElementById("messages").appendChild(div);
    });

    socket.on("system", (msg) => {
      const div = document.createElement("div");
      div.textContent = `[SYSTEM] ${msg.text}`;
      document.getElementById("messages").appendChild(div);
    });
  </script>
</body>
</html>
