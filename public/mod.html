<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Moderator Chatroom</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body { display:flex; flex-direction:column; height:100vh; background:#111; color:#eee; font-family:sans-serif; }
    #login { margin:auto; text-align:center; }
    #chatContainer { display:flex; flex:1; }
    #chat { flex:3; display:flex; flex-direction:column; border-right:2px solid #333; }
    #messages { flex:1; overflow-y:auto; padding:10px; background:#222; }
    #inputBar { display:flex; }
    #inputBar input { flex:1; padding:10px; }
    #users { flex:1; background:#181818; overflow-y:auto; padding:10px; }
    .msg { margin:4px 0; padding:6px; border-radius:5px; }
    .system { color:#aaa; font-style:italic; }
    .owner { color:#ffcc00; font-weight:bold; }
    .mod { color:#4af; font-weight:bold; }
    .user { color:#fff; }
    #modTools { background:#222; padding:10px; border-top:2px solid #333; }
    button { padding:6px 10px; margin:4px; border:none; border-radius:4px; background:#444; color:white; cursor:pointer; }
    button:hover { background:#666; }
  </style>
</head>
<body>
  <!-- Login screen -->
  <div id="login">
    <h2>Moderator Login</h2>
    <input id="modId" placeholder="Enter User ID"><br><br>
    <input id="modPass" type="password" placeholder="Enter Password"><br><br>
    <button id="modLoginBtn">Login</button>
  </div>

  <!-- Chat + moderation panel -->
  <div id="chatContainer" style="display:none;">
    <div id="chat">
      <div id="messages"></div>
      <div id="inputBar">
        <input id="messageInput" placeholder="Type message...">
        <button id="sendBtn">Send</button>
      </div>
      <div id="modTools">
        <h3>Moderation Tools</h3>
        <p>Click on a user to ban/kick them.</p>
      </div>
    </div>
    <div id="users"><h3>Users Online</h3></div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    const loginDiv = document.getElementById("login");
    const chatDiv = document.getElementById("chatContainer");
    const usersDiv = document.getElementById("users");
    const messagesDiv = document.getElementById("messages");

    let currentUser = { id:null, role:null, name:null };

    // Handle login
    document.getElementById("modLoginBtn").onclick = () => {
      const id = document.getElementById("modId").value.trim();
      const pass = document.getElementById("modPass").value.trim();
      
      socket.emit("set-name", { name: id, userId: id, password: pass });
      
      // Show chat after login
      loginDiv.style.display = "none";
      chatDiv.style.display = "flex";
    };

    // Send message
    document.getElementById("sendBtn").onclick = () => {
      const msg = document.getElementById("messageInput").value;
      socket.emit("chat-message", { text: msg });
      document.getElementById("messageInput").value = "";
    };

    // Show messages
    socket.on("chat-message", (msg) => {
      const div = document.createElement("div");
      div.className = "msg " + msg.role.toLowerCase();
      div.innerHTML = `[${msg.role}] <b>${msg.name}</b>: ${msg.text}`;
      messagesDiv.appendChild(div);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    });

    // System messages
    socket.on("system", (msg) => {
      const div = document.createElement("div");
      div.className = "msg system";
      div.textContent = `[SYSTEM] ${msg.text}`;
      messagesDiv.appendChild(div);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    });

    // Show user list + moderation options
    socket.on("userlist", (list) => {
      usersDiv.innerHTML = "<h3>Users Online</h3>";
      list.forEach(user => {
        const div = document.createElement("div");
        div.textContent = `[${user.role}] ${user.name}`;
        div.style.cursor = "pointer";
        div.onclick = () => {
          if (confirm(`Kick ${user.name}?`)) {
            socket.emit("kick-user", user.id);
          }
        };
        usersDiv.appendChild(div);
      });
    });
  </script>
</body>
</html>
